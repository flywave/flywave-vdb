OPTION(ZSTD_LEGACY_SUPPORT "ZSTD_LEGACY_SUPPORT" OFF)

INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/lib")
INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/lib/common")
INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/lib/compress")
INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/lib/dictBuilder")
INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/lib/decompress")

FILE( GLOB zstd_common_SOURCES ${CMAKE_CURRENT_SOURCE_DIR}/lib/common/*.c)
FILE( GLOB zstd_compress_SOURCES ${CMAKE_CURRENT_SOURCE_DIR}/lib/compress/*.c)
FILE( GLOB zstd_dict_SOURCES ${CMAKE_CURRENT_SOURCE_DIR}/lib/dictBuilder/*.c)
FILE( GLOB zstd_decompress_SOURCES ${CMAKE_CURRENT_SOURCE_DIR}/lib/decompress/*.c)

LIST( APPEND zstd_SOURCE_FILES ${zstd_common_SOURCES} ${zstd_compress_SOURCES} ${zstd_dict_SOURCES} ${zstd_decompress_SOURCES})

FILE( GLOB zstd_common_HEADERS ${CMAKE_CURRENT_SOURCE_DIR}/lib/common/*.h)
FILE( GLOB zstd_compress_HEADERS ${CMAKE_CURRENT_SOURCE_DIR}/lib/compress/*.h)
FILE( GLOB zstd_dict_HEADERS ${CMAKE_CURRENT_SOURCE_DIR}/lib/dictBuilder/*.h)
FILE( GLOB zstd_decompress_HEADERS ${CMAKE_CURRENT_SOURCE_DIR}/lib/decompress/*.h)

LIST( APPEND zstd_HEADER_FILES ${zstd_common_HEADERS}
             ${zstd_compress_HEADERS}
             ${zstd_dict_HEADERS}
             ${zstd_decompress_HEADERS}
             ${CMAKE_CURRENT_SOURCE_DIR}/lib/zstd.h)

ADD_LIBRARY(zstd STATIC ${zstd_HEADER_FILES} ${zstd_SOURCE_FILES})

IF(ICU_USE_DATA_FILE_FLAG)
  TARGET_COMPILE_DEFINITIONS(zstd "ZSTD_LEGACY_SUPPORT=1")
ENDIF()

TARGET_INCLUDE_DIRECTORIES(zstd PUBLIC $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/..>)

SOURCE_GROUP("src" FILES ${zstd_SOURCE_FILES})
SOURCE_GROUP("include" FILES ${zstd_HEADER_FILES})

IF(FLYWAVE_ENABLE_SOLUTION_FOLDERS)
  SET_TARGET_PROPERTIES(zstd PROPERTIES FOLDER external)
ENDIF(FLYWAVE_ENABLE_SOLUTION_FOLDERS)
